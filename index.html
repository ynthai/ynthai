<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Puzzle Quest</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f0f0f0;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(6, 50px);
      grid-template-rows: repeat(6, 50px);
      gap: 5px;
    }
    .cell {
      width: 50px;
      height: 50px;
      background-color: #ddd;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
    }
    .cell.selected {
      background-color: #ffcccb;
    }
  </style>
</head>
<body>
  <div id="game-grid" class="grid"></div>

  <script>
    const gridSize = 6; // –†–∞–∑–º–µ—Ä –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è (6x6)
    const colors = ['üî¥', 'üîµ', 'üü¢', 'üü°']; // –¶–≤–µ—Ç–∞ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    let selectedCell = null;

    // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
    function createGrid() {
      const grid = document.getElementById('game-grid');
      for (let i = 0; i < gridSize * gridSize; i++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.textContent = getRandomColor();
        cell.addEventListener('click', () => handleCellClick(cell));
        grid.appendChild(cell);
      }
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç
    function getRandomColor() {
      return colors[Math.floor(Math.random() * colors.length)];
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —è—á–µ–π–∫–µ
    function handleCellClick(cell) {
      if (selectedCell === null) {
        selectedCell = cell;
        cell.classList.add('selected');
      } else {
        swapCells(selectedCell, cell);
        selectedCell.classList.remove('selected');
        selectedCell = null;
      }
    }

    // –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏ –¥–≤–µ —è—á–µ–π–∫–∏
    function swapCells(cell1, cell2) {
      const temp = cell1.textContent;
      cell1.textContent = cell2.textContent;
      cell2.textContent = temp;

      checkMatches(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
    function checkMatches() {
      const grid = Array.from(document.querySelectorAll('.cell'));
      let hasMatch = false;

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –≤ —Å—Ç—Ä–æ–∫–µ
      function findHorizontalMatches() {
        for (let row = 0; row < gridSize; row++) {
          const rowStartIndex = row * gridSize;
          const rowCells = grid.slice(rowStartIndex, rowStartIndex + gridSize);

          let matchCount = 1;
          for (let i = 1; i < rowCells.length; i++) {
            if (rowCells[i].textContent === rowCells[i - 1].textContent && rowCells[i].textContent !== '') {
              matchCount++;
            } else {
              if (matchCount >= 4) {
                markForRemoval(rowCells.slice(i - matchCount, i));
                hasMatch = true;
              }
              matchCount = 1;
            }
          }
          if (matchCount >= 4) {
            markForRemoval(rowCells.slice(-matchCount));
            hasMatch = true;
          }
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –≤ —Å—Ç–æ–ª–±—Ü–µ
      function findVerticalMatches() {
        for (let col = 0; col < gridSize; col++) {
          const columnCells = [];
          for (let row = 0; row < gridSize; row++) {
            columnCells.push(grid[row * gridSize + col]);
          }

          let matchCount = 1;
          for (let i = 1; i < columnCells.length; i++) {
            if (columnCells[i].textContent === columnCells[i - 1].textContent && columnCells[i].textContent !== '') {
              matchCount++;
            } else {
              if (matchCount >= 4) {
                markForRemoval(columnCells.slice(i - matchCount, i));
                hasMatch = true;
              }
              matchCount = 1;
            }
          }
          if (matchCount >= 4) {
            markForRemoval(columnCells.slice(-matchCount));
            hasMatch = true;
          }
        }
      }

      // –û—Ç–º–µ—á–∞–µ–º —è—á–µ–π–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
      function markForRemoval(cells) {
        cells.forEach(cell => cell.textContent = '');
      }

      // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
      findHorizontalMatches();
      findVerticalMatches();

      if (hasMatch) {
        setTimeout(() => refillGrid(), 300); // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏
      }
    }

    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –Ω–æ–≤—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
    function refillGrid() {
      const grid = document.querySelectorAll('.cell');
      for (let i = 0; i < grid.length; i++) {
        if (grid[i].textContent === '') {
          grid[i].textContent = getRandomColor();
        }
      }
    }

    // –î–æ–±–∞–≤–ª—è–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏—à–∞–º–∏
    document.addEventListener('keydown', (event) => {
      if (!selectedCell) return;

      const currentIndex = Array.from(document.querySelectorAll('.cell')).indexOf(selectedCell);
      const row = Math.floor(currentIndex / gridSize);
      const col = currentIndex % gridSize;

      let targetIndex = currentIndex;

      switch (event.key) {
        case 'ArrowUp':
          if (row > 0) targetIndex -= gridSize;
          break;
        case 'ArrowDown':
          if (row < gridSize - 1) targetIndex += gridSize;
          break;
        case 'ArrowLeft':
          if (col > 0) targetIndex -= 1;
          break;
        case 'ArrowRight':
          if (col < gridSize - 1) targetIndex += 1;
          break;
        default:
          return;
      }

      const targetCell = document.querySelectorAll('.cell')[targetIndex];
      if (targetCell) {
        swapCells(selectedCell, targetCell);
        selectedCell.classList.remove('selected');
        selectedCell = null;
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
    createGrid();
  </script>
</body>
</html>
