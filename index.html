<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Puzzle Quest</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f0f0f0;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(6, 50px);
      grid-template-rows: repeat(6, 50px);
      gap: 5px;
    }
    .cell {
      width: 50px;
      height: 50px;
      background-color: #ddd;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
    }
    .cell.empty {
      background-color: #ccc;
    }
    .cell.selected {
      background-color: #ffcccb;
    }
  </style>
</head>
<body>
  <div id="game-grid" class="grid"></div>

  <script>
    const gridSize = 6; // –†–∞–∑–º–µ—Ä –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è (6x6)
    const colors = ['üî¥', 'üîµ', 'üü¢', 'üü°']; // –¶–≤–µ—Ç–∞ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    let selectedCell = null;

    // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
    function createGrid() {
      const grid = document.getElementById('game-grid');
      for (let i = 0; i < gridSize * gridSize; i++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.dataset.index = i;
        if (i >= gridSize) { // –ù–∏–∂–Ω–∏–µ —è—á–µ–π–∫–∏ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è —Ü–≤–µ—Ç–∞–º–∏
          cell.textContent = getRandomColor();
        }
        cell.addEventListener('click', () => handleCellClick(cell));
        grid.appendChild(cell);
      }
      ensureNoFourInARow(); // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –Ω–µ—Ç —á–µ—Ç—ã—Ä–µ—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ–¥—Ä—è–¥
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç
    function getRandomColor() {
      return colors[Math.floor(Math.random() * colors.length)];
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å —á–µ—Ç—ã—Ä—å–º—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –ø–æ–¥—Ä—è–¥
    function ensureNoFourInARow() {
      const grid = Array.from(document.querySelectorAll('.cell'));
      for (let row = 0; row < gridSize; row++) {
        for (let col = 0; col <= gridSize - 4; col++) {
          const index = row * gridSize + col;
          const cells = Array.from({ length: 4 }, (_, i) => grid[index + i]);
          if (cells.every(cell => cell.textContent === cells[0].textContent && cells[0].textContent !== '')) {
            cells[Math.floor(Math.random() * 4)].textContent = getRandomColor();
          }
        }
      }

      for (let col = 0; col < gridSize; col++) {
        for (let row = 0; row <= gridSize - 4; row++) {
          const index = row * gridSize + col;
          const cells = Array.from({ length: 4 }, (_, i) => grid[index + i * gridSize]);
          if (cells.every(cell => cell.textContent === cells[0].textContent && cells[0].textContent !== '')) {
            cells[Math.floor(Math.random() * 4)].textContent = getRandomColor();
          }
        }
      }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —è—á–µ–π–∫–µ
    function handleCellClick(cell) {
      if (selectedCell === null) {
        selectedCell = cell;
        cell.classList.add('selected');
      } else {
        swapCells(selectedCell, cell);
        selectedCell.classList.remove('selected');
        selectedCell = null;
      }
    }

    // –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏ –¥–≤–µ —è—á–µ–π–∫–∏
    function swapCells(cell1, cell2) {
      const temp = cell1.textContent;
      cell1.textContent = cell2.textContent;
      cell2.textContent = temp;

      checkMatches(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
    function checkMatches() {
      const grid = Array.from(document.querySelectorAll('.cell'));
      let hasMatch = false;

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
      for (let row = 0; row < gridSize; row++) {
        for (let col = 0; col <= gridSize - 4; col++) {
          const index = row * gridSize + col;
          const cells = Array.from({ length: 4 }, (_, i) => grid[index + i]);
          if (cells.every(cell => cell.textContent === cells[0].textContent && cells[0].textContent !== '')) {
            cells.forEach(cell => cell.textContent = '');
            hasMatch = true;
          }
        }
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
      for (let col = 0; col < gridSize; col++) {
        for (let row = 0; row <= gridSize - 4; row++) {
          const index = row * gridSize + col;
          const cells = Array.from({ length: 4 }, (_, i) => grid[index + i * gridSize]);
          if (cells.every(cell => cell.textContent === cells[0].textContent && cells[0].textContent !== '')) {
            cells.forEach(cell => cell.textContent = '');
            hasMatch = true;
          }
        }
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª—é–±—ã–µ —Å–æ—Å–µ–¥–Ω–∏–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
      for (let i = 0; i < gridSize * gridSize; i++) {
        const cell = grid[i];
        if (!cell.textContent) continue;

        const neighbors = [
          grid[i - 1], // –õ–µ–≤—ã–π
          grid[i + 1], // –ü—Ä–∞–≤—ã–π
          grid[i - gridSize], // –í–µ—Ä—Ö–Ω–∏–π
          grid[i + gridSize], // –ù–∏–∂–Ω–∏–π
          grid[i - gridSize - 1], // –õ–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π
          grid[i - gridSize + 1], // –ü—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π
          grid[i + gridSize - 1], // –õ–µ–≤—ã–π –Ω–∏–∂–Ω–∏–π
          grid[i + gridSize + 1] // –ü—Ä–∞–≤—ã–π –Ω–∏–∂–Ω–∏–π
        ];

        const matchingNeighbors = neighbors.filter(
          neighbor => neighbor && neighbor.textContent === cell.textContent
        );

        if (matchingNeighbors.length >= 3) {
          cell.textContent = '';
          matchingNeighbors.forEach(neighbor => neighbor.textContent = '');
          hasMatch = true;
        }
      }

      if (hasMatch) {
        setTimeout(() => refillGrid(), 300); // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏
      }
    }

    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –Ω–æ–≤—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
    function refillGrid() {
      const grid = Array.from(document.querySelectorAll('.cell'));
      for (let col = 0; col < gridSize; col++) {
        for (let row = gridSize - 1; row >= 0; row--) {
          const index = row * gridSize + col;
          if (!grid[index].textContent) {
            for (let i = row - 1; i >= 0; i--) {
              const aboveIndex = i * gridSize + col;
              if (grid[aboveIndex].textContent) {
                grid[index].textContent = grid[aboveIndex].textContent;
                grid[aboveIndex].textContent = '';
                break;
              }
            }
          }
        }
      }

      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–≤–µ—Ä—Ö—É
      for (let col = 0; col < gridSize; col++) {
        for (let row = 0; row < gridSize; row++) {
          const index = row * gridSize + col;
          if (!grid[index].textContent && row === 0) {
            grid[index].textContent = getRandomColor();
          }
        }
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
    createGrid();
  </script>
</body>
</html>
