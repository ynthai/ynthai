<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Puzzle Quest</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f0f0f0;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(6, 50px);
      grid-template-rows: repeat(6, 50px);
      gap: 5px;
    }
    .cell {
      width: 50px;
      height: 50px;
      background-color: #ddd;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
    }
    .cell.selected {
      background-color: #ffcccb;
    }
  </style>
</head>
<body>
  <div id="game-grid" class="grid"></div>

  <script>
    const gridSize = 6; // –†–∞–∑–º–µ—Ä –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è (6x6)
    const colors = ['üî¥', 'üîµ', 'üü¢', 'üü°']; // –¶–≤–µ—Ç–∞ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    let selectedCell = null;

    // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
    function createGrid() {
      const grid = document.getElementById('game-grid');
      for (let i = 0; i < gridSize * gridSize; i++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.textContent = getRandomColor();
        cell.addEventListener('click', () => handleCellClick(cell));
        grid.appendChild(cell);
      }
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç
    function getRandomColor() {
      return colors[Math.floor(Math.random() * colors.length)];
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —è—á–µ–π–∫–µ
    function handleCellClick(cell) {
      if (selectedCell === null) {
        selectedCell = cell;
        cell.classList.add('selected');
      } else {
        swapCells(selectedCell, cell);
        selectedCell.classList.remove('selected');
        selectedCell = null;
      }
    }

    // –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏ –¥–≤–µ —è—á–µ–π–∫–∏
    function swapCells(cell1, cell2) {
      const temp = cell1.textContent;
      cell1.textContent = cell2.textContent;
      cell2.textContent = temp;

      checkMatches(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
    function checkMatches() {
      const grid = Array.from(document.querySelectorAll('.cell'));
      let hasMatch = false;

      // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –≥—Ä—É–ø–ø—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
      const visited = new Array(gridSize * gridSize).fill(false);
      for (let i = 0; i < gridSize * gridSize; i++) {
        if (!visited[i] && grid[i].textContent !== '') {
          const group = findConnectedGroup(i, grid[i].textContent, visited);
          if (group.length >= 4) {
            group.forEach(index => (grid[index].textContent = '')); // –£–¥–∞–ª—è–µ–º –≥—Ä—É–ø–ø—É
            hasMatch = true;
          }
        }
      }

      if (hasMatch) {
        setTimeout(() => refillGrid(), 300); // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏
      }
    }

    // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –æ–¥–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
    function findConnectedGroup(index, color, visited) {
      const group = [];
      const stack = [index];
      visited[index] = true;

      while (stack.length > 0) {
        const current = stack.pop();
        group.push(current);

        const neighbors = getNeighbors(current);
        for (const neighbor of neighbors) {
          if (!visited[neighbor] && grid[neighbor].textContent === color) {
            stack.push(neighbor);
            visited[neighbor] = true;
          }
        }
      }

      return group;
    }

    // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å–µ–¥–Ω–∏–µ —è—á–µ–π–∫–∏ (—Å–≤–µ—Ä—Ö—É, —Å–Ω–∏–∑—É, —Å–ª–µ–≤–∞, —Å–ø—Ä–∞–≤–∞)
    function getNeighbors(index) {
      const row = Math.floor(index / gridSize);
      const col = index % gridSize;
      const neighbors = [];

      if (row > 0) neighbors.push(index - gridSize); // –°–≤–µ—Ä—Ö—É
      if (row < gridSize - 1) neighbors.push(index + gridSize); // –°–Ω–∏–∑—É
      if (col > 0) neighbors.push(index - 1); // –°–ª–µ–≤–∞
      if (col < gridSize - 1) neighbors.push(index + 1); // –°–ø—Ä–∞–≤–∞

      return neighbors.filter(idx => idx >= 0 && idx < gridSize * gridSize);
    }

    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –Ω–æ–≤—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
    function refillGrid() {
      const grid = document.querySelectorAll('.cell');
      for (let col = 0; col < gridSize; col++) {
        let emptySpaces = [];
        for (let row = 0; row < gridSize; row++) {
          const index = row * gridSize + col;
          if (grid[index].textContent === '') {
            emptySpaces.push(index);
          }
        }

        if (emptySpaces.length > 0) {
          for (let i = emptySpaces.length - 1; i >= 0; i--) {
            const newIndex = emptySpaces[i] - gridSize;
            if (newIndex >= 0) {
              grid[emptySpaces[i]].textContent = grid[newIndex].textContent;
              grid[newIndex].textContent = '';
            } else {
              grid[emptySpaces[i]].textContent = getRandomColor();
            }
          }
        }
      }
    }

    // –î–æ–±–∞–≤–ª—è–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏—à–∞–º–∏
    document.addEventListener('keydown', (event) => {
      if (!selectedCell) return;

      const currentIndex = Array.from(document.querySelectorAll('.cell')).indexOf(selectedCell);
      const row = Math.floor(currentIndex / gridSize);
      const col = currentIndex % gridSize;

      let targetIndex = currentIndex;

      switch (event.key) {
        case 'ArrowUp':
          if (row > 0) targetIndex -= gridSize;
          break;
        case 'ArrowDown':
          if (row < gridSize - 1) targetIndex += gridSize;
          break;
        case 'ArrowLeft':
          if (col > 0) targetIndex -= 1;
          break;
        case 'ArrowRight':
          if (col < gridSize - 1) targetIndex += 1;
          break;
        default:
          return;
      }

      const targetCell = document.querySelectorAll('.cell')[targetIndex];
      if (targetCell) {
        swapCells(selectedCell, targetCell);
        selectedCell.classList.remove('selected');
        selectedCell = null;
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
    createGrid();
  </script>
</body>
</html>
